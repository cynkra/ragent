---
output: github_document
---

# ragent

A simple R package demonstrating agent functionality using local LLMs through Ollama.

The `ragent` package provides a simple way to create AI agents that can:
- Answer questions using local LLMs
- Search through your documentation
- Combine multiple tools for complex tasks

## Installation

First, make sure you have [Ollama](https://ollama.ai/) installed and the required models:

```bash
ollama pull llama2-3b:1b        # for simple queries
ollama pull deepseek-r1:8b      # for complex reasoning
ollama pull nomic-embed-text    # for knowledge base search
```

Then install the package:

```r
# install.packages("remotes")
remotes::install_github("cynkra/ragent")
```

## Quick Demo

### Basic Tools

Let's start with some simple tools:

```r
library(ragent)

# Create a basic agent with a calculator
agent <- create_agent(
  tools = list(calculator = calc_tool),
  system_prompt = "You are a helpful assistant specialized in calculations."
)

# Do some calculations
agent$process_task("What is the square root of 123.434235435345?")
# Flow:
# 1. Agent recognizes calculation request
# 2. Calls calculator tool: sqrt(123.434235435345)
# 3. Gets result: 11.1101
# 4. Passes result to LLM with prompt:
#    "Using the calculation result 11.1101, provide a clear and helpful response
#     that explains the square root calculation. Format numbers appropriately and
#     add relevant context."
# 5. LLM generates final response:
#    "The square root of 123.434235435345 is 11.1101.
#     I've rounded to 4 decimal places for clarity."

agent$process_task("Calculate 15% of 850")
# Flow:
# 1. Agent recognizes percentage calculation
# 2. Calls calculator tool: 850 * 0.15
# 3. Gets result: 127.5
# 4. Passes result to LLM with prompt:
#    "Using the calculation result 127.5, provide a clear and helpful response
#     about the 15% calculation. Include the original values and add context
#     about where this calculation might be useful."
# 5. LLM generates final response:
#    "15% of 850 equals 127.50 CHF. This could be useful for calculating
#     tips, taxes, or discounts on a purchase of 850 CHF."

# Add a weather tool
weather_tool <- function(location) {
  paste("The weather in", location, "is sunny (this is a mock response)")
}
attr(weather_tool, "description") <- "Returns a weather report for a given location."

agent_weather <- create_agent(
  tools = list(weather_tool = weather_tool),
  system_prompt = "You are a helpful assistant specialized in weather reports."
)

agent_weather$process_task("How is the weather in Zurich?")
# Flow:
# 1. Agent recognizes weather query
# 2. Calls weather tool for Zurich
# 3. Gets result: "The weather in Zurich is sunny"
# 4. Passes result to LLM with prompt:
#    "Using the weather data 'The weather in Zurich is sunny', create a friendly,
#     conversational response. Include suggestions for activities suitable for
#     this weather."
# 5. LLM generates final response:
#    "Great news! The weather in Zurich is sunny today.
#     It's a perfect day for a walk by the lake or enjoying
#     a coffee at an outdoor café."
```

### Knowledge Base Search

Now let's explore the more powerful knowledge base functionality:

```r
# Create a knowledge base tool pointing to your documentation
kb <- kb_tool(
  dir = "~/knowledgebase",  # directory with your markdown/text files
  n_context = 3             # number of relevant chunks to return
)

# Simple search
kb("How do I submit a receipt?")
# Returns relevant chunks with source information and similarity scores

# Create an agent that provides clear explanations
agent <- create_agent(
  tools = list(kb = kb),
  system_prompt = "You are a helpful assistant with access to a knowledge base.
    When answering questions:
    1. Break down complex queries into smaller lookups
    2. Make multiple queries to gather comprehensive information
    3. Combine information from different sources
    4. Provide clear, step-by-step explanations
    Always cite your sources."
)

# Ask a complex question
agent$process_task(
  "I'm planning my vacation. What do I need to know about policies and procedures?"
)
# The agent will:
# 1. Search for relevant information
# 2. Combine findings into a clear response like:
#    "Based on our policies (source: vacation_policy.md), here's what you need to know:
#     1. Submit your request at least 2 weeks in advance
#     2. Get approval from your supervisor
#     3. Update the team calendar
#     I found additional details about holiday schedules in calendar_policy.md..."

# Create an agent that combines tools
agent_advanced <- create_agent(
  tools = list(
    kb = kb,
    calculator = calc_tool
  ),
  system_prompt = "You are a helpful assistant that can search documentation and perform calculations.
    Always provide clear explanations that combine information from multiple sources."
)

# Ask a question that requires both tools
agent_advanced$process_task(
  "According to our policies, what's the total cost for a team lunch of 5 people?"
)
# The agent will:
# 1. Search the knowledge base for lunch allowance policy
# 2. Calculate the total based on the per-person allowance
# 3. Provide a clear response like:
#    "According to our expense policy (source: expenses.md), the lunch allowance is 30 CHF per person.
#     For a team of 5 people, the total budget would be 5 × 30 CHF = 150 CHF.
#     Remember to keep all receipts for reimbursement!"
```

That's it! The agent can now:
- Search your documentation
- Make multiple intelligent queries
- Combine information from different sources
- Use additional tools when needed
- Provide clear, natural language responses

## License

MIT